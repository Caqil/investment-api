{{define "reports/profit"}}
<div class="qor-page__body">
  <div class="qor-section">
    <div class="qor-section__header">
      <h4>Profit Analysis Report</h4>
    </div>
    
    <!-- Date Range Selector -->
    <div class="qor-section__body">
      <form method="GET" action="/admin/reports/profit" class="qor-form">
        <div class="qor-form__row">
          <div class="qor-field">
            <label class="qor-field__label">Start Date</label>
            <div class="qor-field__edit">
              <input type="date" name="start_date" value="{{.StartDate}}" class="qor-field__input">
            </div>
          </div>
          
          <div class="qor-field">
            <label class="qor-field__label">End Date</label>
            <div class="qor-field__edit">
              <input type="date" name="end_date" value="{{.EndDate}}" class="qor-field__input">
            </div>
          </div>
          
          <div class="qor-field">
            <button type="submit" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">Apply</button>
          </div>
        </div>
      </form>
    </div>
    
    <div class="qor-section__body">
      <!-- Total Profit Card -->
      <div class="row">
        <div class="col-md-12">
          <div class="panel panel-success">
            <div class="panel-heading">
              <h5>Total Profit in Selected Period</h5>
            </div>
            <div class="panel-body">
              <h3>{{.TotalProfit}} BDT</h3>
            </div>
          </div>
        </div>
      </div>
      
      <br>
      
      <!-- Profit by Day Chart -->
      <div class="row">
        <div class="col-md-12">
          <div class="panel">
            <div class="panel-heading">
              <h5>Daily Profit Trend</h5>
            </div>
            <div class="panel-body">
              <canvas id="profitChart" width="800" height="400"></canvas>
            </div>
          </div>
        </div>
      </div>
      
      <br>
      
      <!-- Profit Data Table -->
      <div class="row">
        <div class="col-md-12">
          <div class="panel">
            <div class="panel-heading">
              <h5>Profit by Date</h5>
            </div>
            <div class="panel-body">
              <table class="table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Profit (BDT)</th>
                  </tr>
                </thead>
                <tbody>
                  {{range .ProfitByDay}}
                  <tr>
                    <td>{{.Date}}</td>
                    <td>{{.Total}}</td>
                  </tr>
                  {{end}}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Prepare chart data
  var dates = [{{range .ProfitByDay}}"{{.Date}}",{{end}}];
  var profits = [{{range .ProfitByDay}}{{.Total}},{{end}}];
  
  // Create profit chart
  var ctx = document.getElementById('profitChart').getContext('2d');
  var chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: dates,
      datasets: [{
        label: 'Daily Profit (BDT)',
        data: profits,
        backgroundColor: 'rgba(75, 192, 192, 0.7)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
{{end}}