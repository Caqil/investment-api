{{define "reports/user_growth"}}
<div class="qor-page__body">
  <div class="qor-section">
    <div class="qor-section__header">
      <h4>User Growth Report</h4>
    </div>
    
    <!-- Date Range Selector -->
    <div class="qor-section__body">
      <form method="GET" action="/admin/reports/user-growth" class="qor-form">
        <div class="qor-form__row">
          <div class="qor-field">
            <label class="qor-field__label">Start Date</label>
            <div class="qor-field__edit">
              <input type="date" name="start_date" value="{{.StartDate}}" class="qor-field__input">
            </div>
          </div>
          
          <div class="qor-field">
            <label class="qor-field__label">End Date</label>
            <div class="qor-field__edit">
              <input type="date" name="end_date" value="{{.EndDate}}" class="qor-field__input">
            </div>
          </div>
          
          <div class="qor-field">
            <button type="submit" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">Apply</button>
          </div>
        </div>
      </form>
    </div>
    
    <div class="qor-section__body">
      <div class="row">
        <!-- Summary Cards -->
        <div class="col-md-6">
          <div class="panel panel-primary">
            <div class="panel-heading">
              <h5>Total Users</h5>
            </div>
            <div class="panel-body">
              <h3>{{.TotalUsers}}</h3>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="panel panel-info">
            <div class="panel-heading">
              <h5>New Users (Selected Period)</h5>
            </div>
            <div class="panel-body">
              <h3>{{.NewUsers}}</h3>
            </div>
          </div>
        </div>
      </div>
      
      <br>
      
      <!-- User Growth Chart -->
      <div class="row">
        <div class="col-md-12">
          <div class="panel">
            <div class="panel-heading">
              <h5>User Growth Trend</h5>
            </div>
            <div class="panel-body">
              <canvas id="userGrowthChart" width="800" height="400"></canvas>
            </div>
          </div>
        </div>
      </div>
      
      <br>
      
      <!-- User Growth Data Table -->
      <div class="row">
        <div class="col-md-12">
          <div class="panel">
            <div class="panel-heading">
              <h5>User Registration by Date</h5>
            </div>
            <div class="panel-body">
              <table class="table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>New Users</th>
                  </tr>
                </thead>
                <tbody>
                  {{range .UserGrowthData}}
                  <tr>
                    <td>{{.Date}}</td>
                    <td>{{.Count}}</td>
                  </tr>
                  {{end}}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Prepare chart data
  var dates = [{{range .UserGrowthData}}"{{.Date}}",{{end}}];
  var counts = [{{range .UserGrowthData}}{{.Count}},{{end}}];
  
  // Create user growth chart
  var ctx = document.getElementById('userGrowthChart').getContext('2d');
  var chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: dates,
      datasets: [{
        label: 'New Users',
        data: counts,
        borderColor: 'rgba(54, 162, 235, 1)',
        backgroundColor: 'rgba(54, 162, 235, 0.2)',
        borderWidth: 2,
        fill: true,
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            precision: 0
          }
        }
      }
    }
  });
</script>
{{end}}